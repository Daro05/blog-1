<p><em>Mac and I aren’t breaking up, we’re just seeing other people.</em></p>

<h2 id="intro">Intro</h2>

<p>I’d been jonesing for a laptop with a real GPU for a couple years.  Granted, most of my computation occurs on remote servers, but sometimes when I’m traveling, those connections can be spotty.  And heck, I might want to play the occasional video game (without NVIDIA GeForce NOW).</p>

<p>Twenty years ago, I switched from Linux/Windows dual-boot to Mac so I could get shiny apps, and to not have to worry about device drivers, etc.  But with Apple dragging their feet re. hardware upgrades, I finally took the plunge – <em>before</em> my Mac died, so I’d have plenty of time to transition.</p>

<p>Got a <a href="https://system76.com/laptops/oryx">System76 Oryx Pro</a>. With Pop!_OS 19.10 — I’m used to Ubuntu, so this is a bit new.  I’m so impressed with the System76 folks that I want to try to stay with their Pop!_OS because I know they’ve been doing the tweaking so it’ll work well with their laptops, and also so I can legit bug them when I hit problems. ;-)  Like Ubuntu, Pop!_OS is a Debian variant, so much of the same actions apply.</p>

<p>Similar posts by others:</p>

<ul>
  <li>https://www.theportlandcompany.com/2017/08/14/switching-mac-ubuntu-gnome-17-04/</li>
  <li>http://www.matthewbuscemi.com/blog/2019-06-05-the-great-linux-migration-of-2019.html</li>
</ul>

<h2 id="syncing-with-apple-ecosystem">Syncing with Apple Ecosystem</h2>

<p><em>(from within Linux. See below for alleged VirtualBox installation of MacOS)</em></p>

<p>I still have an iPad &amp; iPhone, so finding a solution that could sync with what I already have (rather than, e.g., going with Google Calendars) was helpful.</p>

<p>One could simply use iCloud.com via a web browser, but I'd like to integrate a bit more with the Linux ecosystem.</p>

<ul>
  <li>
    <p><strong>Mail:</strong></p>

    <p>I tried Geary, Thunderbird &amp; Evolution. Found more online instructions for using Evolution.  Evolution doesn’t to do like Mac’s Mail.app does, namely integrate all your inboxes into one unified Inbox – you have to go an check each inbox for each account. <a href="https://www.svenbit.com/2011/05/create-a-unified-inbox-folder-in-evolution/">But here’s a workaround to fake it</a>.   (Thunderbird supports a <a href="https://support.mozilla.org/en-US/questions/1009047">nice unified inbox</a> view. Note that Thunderbird’s font size is minuscule, but <a href="https://support.mozilla.org/en-US/questions/1276127">you can rescale it</a>.)</p>

    <p>My account types: Gmail and Microsoft Exchange.</p>
  </li>
  <li>
    <p><strong>Calendar:</strong></p>

    <p>Evolution will integrate with Apple: https://ar.al/2018/08/05/using-icloud-calendars-on-gnu-linux/</p>

    <p>Note that accounts added in Evolution will propagate to default Gnome Calendar app too, but there’s no way to get Gnome to add new Apple calendars; only Evolution provides this functionality, it seems.</p>
  </li>
  <li>
    <p><strong>Contacts:</strong></p>

    <p>Evolution again: https://ar.al/2018/08/05/getting-your-icloud-contacts-on-gnu-linux/</p>

    <p>Sadly, unlike the Mac, when you try to <em>use</em> the contacts, for example when you start addressing an email, it won’t prioritize the search/matching list by the most recent people you’ve actually contacted.  Rather the names of people you haven’t interacted with in years will dominate the list of names.</p>
  </li>
  <li>
    <p><strong>Notes (wrapper to web app):</strong></p>

    <p>iCloud Notes Snap: https://www.addictivetips.com/ubuntu-linux-tips/use-icloud-on-linux/</p>

    <p>All this thing is is a web browser that connects to Apple's iCloud notes page. So no using this offline.  Note that you have to log out &amp; back in before you see Snap apps.  <strong>Also note</strong> that Hide/Minimize on this window will make it <em>almost impossible to recover</em>. (??) Thus I tend to move the window to another desktop.</p>
  </li>
  <li>
    <p><strong>Messages (SMS)</strong></p>

    <p>TL/DR: It’s a no-go.</p>

    <p>There is no iCloud version of Messages. Apple won't allow 3rd party apps.</p>

    <p><a href="https://wiki.gnome.org/Attic/PhoneManager">Gnome Phone Manager</a> was supposed to let you pair with your phone via Bluetooth and then send &amp; receive messages, but it’s obsolete now and I couldn’t get it to work.</p>

    <p>KDE has a "Connect" app, but I'm not abandoning all the Gnome setup I’ve done to switch to KDE!  And it probably only works with Android.</p>

    <p><a href="https://wammu.eu/">Wammu</a> is unable to connect to my (Bluetooth-paired) phone.</p>

    <p>You could configure your old Mac as a remote Messages server, but this implementation is insecure: https://github.com/cvincent/umessage</p>

    <p>Verizon doesn't offer a Linux version of their Message+ app, but you can send/receive via their web site.</p>

    <p>…One could always use some alternate messaging ‘ecosystem’ like <a href="https://web.whatsapp.com/">WhatsApp’s web app</a> or Signal, but I was looking for ways to get ‘regular’ SMS messages for my existing number. :-/</p>
  </li>
  <li>
    <p><strong>Files</strong>:</p>

    <p>Honestly Dropbox is fine!  I turned on ssh ‘sharing’ on my Mac so I can <code class="highlighter-rouge">scp</code> files if I need to, but Dropbox on Linux is as easy as one would imagine.</p>
  </li>
  <li>
    <p><strong>Music</strong>:</p>

    <p>For actual audio production, I’ll need to keep the Mac around for Logic &amp; Pro Tools.  As far as casual listening to music,…eh. I’m fine with Pandora.  (I’m not a Spotify user.)  <strong>Note:</strong> Did get <a href="https://twitter.com/drscotthawley/status/1214424186464194560">studio audio working under Linux</a> though! See below under “Audio”.</p>
  </li>
  <li>
    <p><strong>Backups:</strong></p>

    <p>I have an Apple “Time Capsule” WiFi-cum-backup server.  <a href="https://apple.stackexchange.com/questions/160250/backup-of-a-debian-machine-to-an-apple-time-capsule">It’s not going to be possible to back up <em>both</em> the Mac and the Linux machine to the same device</a>.  I’ll need to choose which machine to back up there. Some have suggested getting a Raspberry Pi and mount a $30 2TB HD to it for backing up the Linux machine. <strong>TODO.</strong></p>
  </li>
</ul>

<h2 id="cuda--tensorflow--pytorch">CUDA / Tensorflow / PyTorch</h2>

<p>TL/DR: this was the grand hope of buying this computer. Still not able to run yet, but I’ll never give up. ;-)</p>

<p>This main challenge, as with any system really, is grabbing a version of CUDA that will allow you to grab at least a few binaries:</p>

<ul>
  <li>
    <p>Latest CUDA via <a href="https://support.system76.com/articles/cuda/">system76's distro</a> is 10.2.  They don’t offer 10.1 anymore.</p>
  </li>
  <li>PyTorch builds only support up to 10.1.  To get CUDA 10.2 support, I built PyTorch from source.  My research code isn’t running…I suspect because something in PyTorch changed re. multiprocessing support. :-(.</li>
  <li>
    <p>System76 made a "<a href="https://github.com/pop-os/tensorman">tensorman</a>" docker util. I confess to my shame that I still find docker to be rather confusing.  Using tensorman, I was able to run their tiny demo but not my own research codes.  I tried building my own docker image but….didn't enjoy it. Went back to what I know: Anaconda.  Still no success.  TODO: Will update.</p>
  </li>
  <li>Tensorflow binaries go up to CUDA 10.0.   I'd built tensorflow-gpu from source multiple times on Ubuntu systems...but I spent 3 days on this thing and still haven't gotten it to build. Some kind of error with grpc at gettid. :-/  <strong>OOoo! Got it!</strong>  Uh, at least, it compiles.</li>
</ul>

<h2 id="document-editing">Document Editing</h2>

<ul>
  <li>
    <p><strong>Markdown</strong>: Over the years, I’ve tried a number of Markdown editors – Haroopad, Mou, Ghost, StackEdit.  Then today I discovered <a href="https://typora.io">Typora</a>.  It is my favorite by far!</p>
  </li>
  <li>
    <p><strong>Code:</strong> I like Atom or VSCode for code (same as I did on the Mac).</p>
  </li>
  <li>
    <p><strong>Office:</strong> LibreOffice seems, so far, to be able to read &amp; write my Microsoft Office files without mangling them!  It’s <em>uglier</em>, but that’s par for the course.</p>
  </li>
  <li>
    <p><strong>(Nonfiction) Book authorship:</strong></p>
    <ul>
      <li>I’d been working on a book using Scrivener 3.  Scrivener released a(n unofficial) <a href="https://www.steinberg.net/forums/viewtopic.php?f=157&amp;t=62290&amp;sid=83ae2e7f166857420498e68412dfea4f&amp;start=25">Linux port</a> but it’s old.  Linux users now typically either run the Windows or Mac versions however they can.  See “MacOS on Linux via VirtualBox”, below. (<strong>Score!</strong> Mac license key successfully-hypothetically accepted in VirtualBox guest OS.)</li>
      <li>Alternatives: <a href="https://www.theologeek.ch/manuskript/">Manuskript</a> (cf. novelist <a href="http://matthewbuscemi.com/blog/2019-06-07-hello-manuskript.html">Matthew Buscemi’s notes on switching from Scrivener to Manuskript</a>), or <a href="https://github.com/Sigil-Ebook/Sigil">Sigil</a> for EPUBs, <a href="https://www.scribus.net/">Scribus</a> for print layout,…?   …Well and of course LaTeX! ;-)</li>
    </ul>
  </li>
</ul>

<h2 id="peripherals">Peripherals</h2>

<p>One doesn’t hope for much with Linux, but I’ve succeeded with more than I’d hoped for.  As follows…</p>

<h3 id="audio">Audio</h3>

<ul>
  <li>
    <p><strong>Bluetooth pairing</strong> to a Bose Soundlink works fine: Ooo, and the volume buttons on the keyboard control the Bluetooth speaker volume!</p>
  </li>
  <li>
    <p>My <strong>Focusrite</strong> 2i2 USB box works right away – <em>sort of</em>.  The OS recognizes it but then ignores it and just keeps using the laptop defaults regardless of what you set for the System Settings.  Yet Audacity will actually use it correctly. ¯\_(ツ)_/¯.  Officially, Focusrite claims <a href="https://support.focusrite.com/hc/en-gb/articles/208530735-Is-my-Focusrite-Product-compatible-with-Linux-">no Linux support</a>, but allows that you might get lucky since they are USB class-compliant.  <strong>UPDATE:</strong> If you manually set the Sound setting to Internal Speakers and <em>then</em> set it to the Focusrite, then the Focusrite gets used for everything.  (Seems that the Plug’n’Play is a bit messed up.)</p>
  </li>
  <li>
    <p>My <strong>Steinberg UR44</strong> USB audio interface… was not recognized at first.  There’s a <a href="https://www.steinberg.net/forums/viewtopic.php?f=157&amp;t=62290&amp;sid=f9bd688247495effd78eecc481c321a2&amp;start=25">thread from 2014 on the Steinberg forums</a> for setting up both the UR22 and UR44 on Linux.  They say you need to flip the switch on the back of the device to “Class Compliant (CC)” mode.  Then turn the Steinberg off &amp; on (i.e. unplug the power cable &amp; plug it in) and…voila!  It now shows up!  <strong><a href="https://twitter.com/drscotthawley/status/1214424186464194560">I have studio-quality audio I/O!!</a></strong></p>
  </li>
</ul>

<h3 id="video">Video</h3>

<ul>
  <li>
    <p><strong>External Displays (HDMI):</strong>  One thing that will require getting used to will be the fact that you can only use the HDMI port on the Oryx Pro when the NVIDIA GPU is fully enabled.  You can’t use it with the Intel Graphics or Hybrid Graphics.  And switching graphics modes requires a reboot. :-/   But after rebooting, it works!  Too bad the battery life isn’t so hot with the NVIDIA card, but that’s ok. ;-)</p>

    <p>….Uh, and apparently it refuses to route audio through HDMI even though it should.  Hmm.  Found this out the hard way when teaching a university class to audio engineering students. :-(</p>
  </li>
</ul>

<h3 id="apple-wireless-keyboard">Apple Wireless Keyboard</h3>

<ul>
  <li>
    <p>The Pop!_OS/Gnome GUI-based Bluetooth pairing method wasn’t working super great, so I started out following <a href="http://freewisdoms.com/apple-wireless-keyboard-on-ubuntu/">these command-line instructions</a> and then switched over to to Pop!_OS GUI once the scan was in progress.</p>

    <blockquote>
      <p>Currently typing these words on my wireless keyboard, with the laptop in the closet, looking at my external monitor connected via HDMI, listening to external monitor speakers controlled by the Steinberg UR44! :)</p>
    </blockquote>
  </li>
</ul>

<h2 id="customization">Customization</h2>

<ul>
  <li>
    <p><strong>Gnome:</strong></p>

    <ul>
      <li>System76 posted a <a href="https://support.system76.com/articles/customize-gnome/">list of handy Gnome extensions</a>.</li>
      <li><a href="https://itsfoss.com/gnome-tweak-tool/">Gnome Tweaks</a>, e.g. for adding Minimize/Maximize buttons to the windows!  The default Gnome desktop…I do not understand what those developers are thinking, other than “Let’s waste screen real estate.”</li>
    </ul>
  </li>
  <li>
    <p><strong>Keyboard Colors (on Oryx Pro):</strong> There are a few utilities out there. I went with <a href="https://github.com/davemcphee/oryx-kb-leds">this one</a>. Note that there are only three "zones" of color definable, not controls for each key. Also had to use <code class="highlighter-rouge">sudo</code> to enable user writing to appropriate <code class="highlighter-rouge">/sys/</code> devices.</p>
  </li>
  <li>
    <p><strong>Scrolling:</strong> Unlike the Mac, the trackpad scrolling behavior seems to be app-specific.  As I write this, Typora doesn’t offer any inertia – also called “coasting” – whereas a few Gnome apps (except Terminal!) offer near-perfect Mac-like inertia scrolling, whereas Thunderbird, Atom &amp; VSCode offer none.  <strong>SOLUTION:</strong>  Install the “Synaptics” (legacy) driver:</p>

    <p><code class="highlighter-rouge">sudo apt install xserver-xorg-input-synaptics</code></p>

    <p>…then log out &amp; log back in. Now things are <em>much</em> better; it’s a  <strong>pretty buggy</strong> and sometimes the kinetic scrolling won’t kick in, and other times it will. But this is a vast improvement.  (Note: I did <em>not</em> uninstall <code class="highlighter-rouge">libinput</code> but rather left it in.)</p>

    <p><strong>Oh but wait!</strong>  On reboot the trackpad was dead!  The only solution was to <em>uninstall</em> the synaptics driver :-( and now the trackpad works again.</p>
  </li>
</ul>

<h2 id="macos-on-linux-via-virtualbox">MacOS on Linux via VirtualBox</h2>

<p>(Given Apple’s EULA, the following is purely a hypothetical scenario <em>for discussion purposes only.</em>..)</p>

<p>Sometimes one may simply need a particular Mac app.  This <a href="https://en.wikibooks.org/wiki/VirtualBox/Setting_up_a_Virtual_Machine/Mac_OS_X">“semi-automated install script” described on the VirtualBox Wikibooks page</a> is…I am told, hypothetically…awesome!  It will – allegedly, mind you – automatically grab the MacOS ISO and set everything up!   <em>(Note that the first time that hypothetical-me might have tried this, hypothetical-me may have missed a bunch of the prompts from the script because the VirtualBox window had obscured the Terminal.  Don’t be like said hypothetical-me – hypothetically you should follow the script, and just press enter at the appropriate moments.)</em>   And it allegedly mostly “just works.”</p>

<p>Also: Catalina won’t work yet; only Mojave for now.</p>

<ul>
  <li>
    <p><strong>Main Issues:</strong></p>

    <ul>
      <li>
        <p><strong>Guest Additions</strong> don’t get set up. For a long time, VirtualBox didn’t have Guest Additions for Mac guests, and then it did, and now the newest VirtualBox (version 6.1) doesn’t.  <em>But</em> the above script installs version 6.0.14, and for versions 6.0.12 to 6.0.14 there <em>were</em> Guest Additions for Mac! <a href="https://download.virtualbox.org/virtualbox/6.0.14/VBoxGuestAdditions_6.0.14.iso">Still available for download here</a>.  Then <a href="https://stackoverflow.com/questions/41691803/how-to-install-guest-addition-in-mac-os-as-guest-and-windows-machine-as-host">following these instructions</a>, one might download this .iso file from within the macOS guest, then mount it (via the Finder), then double-click on the file <code class="highlighter-rouge">VBoxDarwinAdditions.pkg</code> to install them.  Doing this will enable shared clipboards and…</p>
      </li>
      <li>
        <p><strong>Shared Folders – not.</strong>  Once the Guest Additions are up, one may try to create a directory on the Mac client, e.g. <code class="highlighter-rouge">mkdir ~/linux</code> as a mount point, and set up a shared folder in Virtual Box that could auto-mount to this location…. and then one can hypothetically waste HOURS AND HOURS and never it get it to work, at which point one may give up and just use Dropbox or some ****.  Really I just wanted this for Scrivener, so syncing <code class="highlighter-rouge">~/Dropbox/Documents</code>  would be sufficient.</p>

        <p><em>Alternatively,</em> you could use “File Sharing” to setup a Samba server, but…Not gonna.</p>
      </li>
      <li>
        <p><strong>Insanely Slow Execution.</strong> Lots of issues with the Mac guest, one of which is that it’ll only utilize 1 CPU!</p>
      </li>
      <li>
        <p><strong>Low Display Resolution</strong> by default. But fixable by changing the EFI resolution, such as by running on the host system the command</p>

        <p><code class="highlighter-rouge">$ VBoxManage setextradata "macOS" VBoxInternal2/EfiGraphicsResolution 1600x900</code></p>
      </li>
    </ul>
  </li>
  <li>
    <p>For some reason, iMessages won’t hypothetically login, even though other aspects of iCloud &amp; AppleID link. No errors, just…doesn’t seem to work….so I’m told.</p>
  </li>
  <li>
    <p>“Obviously”, hardware-stuff like the Facetime camera probably will never work. Don’t care.</p>
  </li>
</ul>

<h2 id="dual-boot---adding-windows">Dual Boot - adding Windows</h2>

<p><em>(Let’s be honest: this is just for playing video games.)</em></p>

<p>The <a href="https://pop.system76.com/docs/dual-booting-windows/">System76 instructions</a> seem to start in the middle of something; pretty confusing.  And there’s a <a href="https://pop.system76.com/docs/dual-booting-windows/">second set of System76 instructions</a> with almost the same title.  Turns out the former is for adding Pop!_OS to Windows, and the latter is for adding Windows to Pop!_OS. The latter is what I wanted… but… wasn’t able to follow what they did.  So….here’s what I did:</p>

<ol>
  <li>
    <p>You can’t repartition your hard drive while it’s being used.  So create a bootable USB image of either <a href="https://support.system76.com/articles/pop-live-disk/">all of Pop!_OS</a> or else just the <a href="https://gparted.org/liveusb.php">GParted partitioning tool</a>.  The Popsicle utility is good for flashing USBs.</p>
  </li>
  <li>
    <p>Restart the machine, hold F7, and select the USB from the boot menu.  Then you can run GParted.  My version looked like the following, where /dev/sda3 is the main partition that started as all Pop!_OS:</p>

    <p><img src="https://i.imgur.com/ebIVLhK.png" alt="gparted screenshot" /></p>
  </li>
  <li>
    <p>All you need to do is resize the big partition to a smaller size.  I made mine such that it would free up 120 GB. You don’t need to create a new partition in the newly-unallocated space or format it; Windows will do that.</p>
  </li>
  <li>
    <p>Get a legit bootable Windows 10 ISO somehow, e.g. by downloading from Microsoft or (mumble mumble).  Mine was super-old which made what follows extra-fun.  (I used a second USB stick by the way).  At least it still had a valid Activation Key. :-)</p>
  </li>
  <li>
    <p>Restart with with Windows ISO USB inserted, hold F7, boot to the Windows installer.  In the installer, when choosing a partition, choose the empty space that was leftover after you shrunk (shrank?) your main Linux partition. Install Windows there.</p>
  </li>
  <li>
    <p>Windows installs itself at the <em>front</em> of the machine’s <em>rudimentary</em> boot-loading menu (the F7 thing), meaning that, congratulations, your machine now boots to Windows by default, and I haven’t figured out how to change that.  Good news is, the Windows install process will require restarting a <em>bunch</em> of times, so at least that will happen automatically (without you having to choose not-Linux over &amp; over).</p>
  </li>
  <li>
    <p>When Windows finally came up, it couldn’t detect the WiFI device on the laptop!  That was a bit scary, and  made it rather challenging to download any sort of updates.  Thankfully the Ethernet jack worked, and so I was able to download enough updates so that eventually (after many incremental update-installs and reboot cycles) the WiFi device started working.</p>
  </li>
  <li>
    <p>Managed to install everything I wanted, included Steam and Uplay.  Got “Rise of the Tomb Raider” for $12 and played it on max settings at 80 to 100 FPS with no trouble. :-)   (Well, note that the machine gets super-hot and the fan runs like crazy, but what do you expect?)</p>
  </li>
  <li>
    <p>Now, every time I want to boot to Linux, I have to remember to hold F7.  …Oh well.</p>
  </li>
</ol>

<h2 id="trouble">Trouble!</h2>

<p>When I came back to Linux from Windows, the system started hanging intermittently.  I though maybe it was limited to the trackpad but it seems there are <a href="https://askubuntu.com/questions/1185491/ubuntu-19-10-freezes-and-lags-reguarly">many reports of freezing with Ubuntu 19.10</a> (which Pop!_OS inherits from) for certain video drivers, and in fact I was in “full NVIDIA mode” when I came back to Linux from Windows.   Tonight I’ve been typing the rest of this in Hybrid Graphics mode with not a single hang. So…maybe that’s all I can hope for for now.</p>

<p>I’ll get by.</p>

<p>….How about we stop there for now.  I’ll post another edit of this once PyTorch &amp; Tensorflow are working to my satisfaction.</p>

<p><strong>P.S.-</strong> Oh hey. I was going to end that last line with a fingers-crossed emoji, only to find out that <a href="https://www.omgubuntu.co.uk/2014/11/see-install-use-emoji-symbols-ubuntu-linux">Ubuntu and most Linux distributions don’t supoort emoji</a> by default, but there is a <a href="https://wiki.gnome.org/Design/Apps/CharacterMap">Gnome Characters</a> package, which after installing, will let you do this: 🤞😃👍</p>

<hr />

<p>-SH, 1/13/2020.</p>
